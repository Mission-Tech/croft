name: Dependabot PR Instructions

on:
  pull_request:
    types: [opened]

jobs:
  add-instructions:
    if: github.actor == 'dependabot[bot]'
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
    steps:
      - name: Add comment with deployment instructions
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `ðŸ‘‹ **Dependabot PR detected!**

              This PR won't automatically run infrastructure deployment workflows due to security restrictions.

              **To trigger deployment with secrets:**
              1. Review the dependency changes carefully
              2. Add the \`deploy-preview\` label to this PR
              3. The infrastructure workflow will run with full access to secrets

              **Or manually trigger:**
              - Go to [Actions â†’ Infrastructure Deployment](../actions/workflows/infra.yml)
              - Click "Run workflow"
              - Select this PR's branch

              The validation workflow has already run to check Terraform syntax.`
            })
